#!/bin/bash

#------------------------------------------------------------------------------
# Define default values:
#------------------------------------------------------------------------------

: "${KV_IP:=127.0.0.1}"
: "${KV_PORT:=2379}"
: "${KV_KEY:=/mesos/dns}"

#------------------------------------------------------------------------------
# Functions:
#------------------------------------------------------------------------------

function dns_alive() {
  timeout -t 2 bash -c \
  "echo > /dev/tcp/127.0.0.1/${MDNS_PORT}" &> /dev/null \
  && return 0 || return 1
}

#------------------------------------------------------------------------------
# Main loop:
#------------------------------------------------------------------------------

while true; do
  dns_alive && echo "$(date) alive" || echo "$(date) dead"
  sleep 1
done
